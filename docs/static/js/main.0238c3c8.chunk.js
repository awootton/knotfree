(this["webpackJsonpatw-react-test44"]=this["webpackJsonpatw-react-test44"]||[]).push([[0],{11:function(e,n,t){"use strict";(function(e){t.d(n,"f",(function(){return m})),t.d(n,"d",(function(){return v})),t.d(n,"e",(function(){return w})),t.d(n,"b",(function(){return y})),t.d(n,"c",(function(){return k})),t.d(n,"a",(function(){return O}));var o=t(8),i=t(19),r=t(3),s=t(78),a=t(97),c=t(64),l=t(39),u=t(37),f=t(47),d=t(98),h=t(57),p=t(96),g=t(65);t(80),t(221);function m(){var e=[];return e.push(s.a()),e.push(a.c()),e.push(c.d()),e.push(l.c()),e.push(u.e()),e.push(f.c()),e.push(h.c()),e.push(p.c()),e.push(s.a()),e.push(d.c()),e.push(g.c()),e}r.l(),new Uint8Array,new Uint8Array,new Map;function v(n,t,s,a){t.startsWith("=")?console.log("WARNING why are we using a hashed topic?"):t=t.toLowerCase();var c=t,l=!0===n.isPing,u=r.x(24),f=Date.now(),d=r.s(),h=Object(o.a)(Object(o.a)({},n),{},{id:u,when:f,permanent:!1,topic:c,message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(e,n){a(e.message,n)},options:new Map,returnAddress:i.c.myReplyChannel,context:d});i.d(h.id,h);var p=r.s().ourPublicKey[0],g=r.m(t).ourPublicKey[0],m=s,v={retain:!1,qos:0,properties:{responseTopic:i.c.myReplyChannel,userProperties:{api1:n.id,nonc:u,pubk:r.z(p)}}};if(!0===n.debug&&(v.properties.userProperties.debg="12345678"),l){if(void 0===i.c.client)return void console.log("ERROR mqttServerThing.client === undefined");i.c.client.publish(t,m,v),l||console.log("sent out api1 DANGER skipCryptoForThisOne  topic,id ",t,u," with "+m,"pubk ",r.o(d.ourPublicKey[0]),r.p())}else{console.log("sending api1 call topic,id ",t,u," with "+m,"pubk ",r.o(d.ourPublicKey[0]),r.p());var w=r.s().ourSecretKey[0];0!==m.length&&0!==u.length&&0!==g.length&&0!==w.length||console.log("SendApiCommandOut util.BoxItItUp bad args");var y=r.a(e.from(m),e.from(u),g,w);if(void 0===i.c.client)return void console.log("ERROR mqttServerThing.client === undefined");i.c.client.publish(t,y,v)}l||(void 0!==b&&clearTimeout(b),b=setTimeout((function(){i.c.sendAPing()}),100))}var b=void 0,w=function(n,t,o){var s=n.options.get("nonc");void 0===s&&(s=n.id,console.log("ERROR returnId === undefined happened"));for(var a={retain:!1,qos:0,properties:{userProperties:{}}},c=0,l=Array.from(n.options.entries());c<l.length;c++){var u=l[c],f=u[0],d=u[1];a.properties.userProperties[f]=d}var h=r.k(n.topic);a.properties.userProperties.api1=s,a.properties.userProperties.nonc=s,a.properties.userProperties.pubk=r.z(h.ourPublicKey[0]);var p=n.returnAddress;if(p.startsWith("=")||console.log("error topic should be hashed in server?"),!0===(!0===n.isPing))i.c.client.publish(p,t,a);else{var g=e.from(s),m=n.options.get("pubk")||"",v=r.i(m),b=h.ourSecretKey,w=r.a(t,g,v,b[0]);i.c.client.publish(p,w,a)}};function y(n,t,i){var s=Object(o.a)({},i);s.permanent||console.log("no no no, this is the handler for api calls which are permanent");e.from(s.message).toString("utf-8");var a=!0===s.isPing,c=!0===s.isEvent;if(a||c)s.waitingCallbackFn(s);else{var l=e.from(s.message),u=e.from(s.options.get("nonc")||"");0===u.length&&console.log("ERROR missing nonc ");var f=s.options.get("pubk")||"";0===f.length&&console.log("ERROR missing pubk ");var d=r.i(f),h=r.k(s.topic).ourSecretKey[0],p=r.d(l,u,d,h);s.message=p,0===p.length?console.log("unboxing disaster inHandleApi1PacketIn  "):s.waitingCallbackFn(s)}}function k(n,t,o){o.permanent&&console.log("oops, this is the handler for replies which are not permanent");e.from(o.message).toString("utf-8");if(!0===o.isPing)o.waitingCallbackFn(o);else{void 0==o.context&&console.log("ERROR context was supposed to be set by SendApiCommandOut ");var i=e.from(o.message),s=e.from(o.options.get("nonc")||"");0===s.length&&console.log("ERROR missing nonc ");var a=o.options.get("pubk")||"";0===a.length&&console.log("ERROR missing pubk ");var c=r.i(a),l=(o.context||r.h).ourSecretKey[0],u=r.d(i,s,c,l);o.message=u,0===u.length?console.log("unboxing disaster inHandleApi1PacketIn  "):o.waitingCallbackFn(o)}}function O(e,n){var t=e.username+"_broadcast";t.startsWith("=")||(t=t.toLowerCase());var o={cmd:"Event",who:e.username,what:n},s={retain:!1,qos:0,properties:{responseTopic:e.username,userProperties:{api1:"Event",nonc:r.x(24),pubk:r.z(e.ourPublicKey[0])}}},a=JSON.stringify(o);i.c.client.publish(t,a,s)}}).call(this,t(9).Buffer)},13:function(e,n,t){"use strict";var o;t.d(n,"a",(function(){return i})),t.d(n,"d",(function(){return r})),t.d(n,"c",(function(){return s})),t.d(n,"f",(function(){return a})),t.d(n,"e",(function(){return c})),t.d(n,"b",(function(){return l})),function(e){e[e.ReadPermissionEveryone=1073741824]="ReadPermissionEveryone",e[e.WritePermissionEveryone=-2147483648]="WritePermissionEveryone",e[e.CommentPermissionEveryone=536870912]="CommentPermissionEveryone",e[e.ReadPermissionFriends=268435456]="ReadPermissionFriends",e[e.WritePermissionFriends=134217728]="WritePermissionFriends",e[e.CommentPermissionFriends=67108864]="CommentPermissionFriends",e[e.ReadPermissionFamily=33554432]="ReadPermissionFamily",e[e.WritePermissionFamily=16777216]="WritePermissionFamily",e[e.CommentPermissionFamily=8388608]="CommentPermissionFamily",e[e.ReadPermissionFollowers=4194304]="ReadPermissionFollowers",e[e.WritePermissionFollowers=2097152]="WritePermissionFollowers",e[e.CommentPermissionFollowers=1048576]="CommentPermissionFollowers",e[e.ReadPermissionFollowing=524288]="ReadPermissionFollowing",e[e.WritePermissionFollowing=262144]="WritePermissionFollowing",e[e.CommentPermissionFollowing=131072]="CommentPermissionFollowing",e[e.ReadPermissionGroup1=65536]="ReadPermissionGroup1",e[e.WritePermissionGroup1=32768]="WritePermissionGroup1",e[e.CommentPermissionGroup1=16384]="CommentPermissionGroup1",e[e.ReadPermissionGroup2=8192]="ReadPermissionGroup2",e[e.WritePermissionGroup2=4096]="WritePermissionGroup2",e[e.CommentPermissionGroup2=2048]="CommentPermissionGroup2",e[e.ReadPermissionGroup3=1024]="ReadPermissionGroup3",e[e.WritePermissionGroup3=512]="WritePermissionGroup3",e[e.CommentPermissionGroup3=256]="CommentPermissionGroup3"}(o||(o={}));var i=o.ReadPermissionFriends|o.CommentPermissionFriends|o.ReadPermissionFamily|o.CommentPermissionFamily|o.ReadPermissionFollowers|o.CommentPermissionFollowers|o.ReadPermissionFollowing|o.CommentPermissionFollowing|o.ReadPermissionGroup1|o.CommentPermissionGroup1|o.ReadPermissionGroup2|o.CommentPermissionGroup2|o.ReadPermissionGroup3|o.CommentPermissionGroup3;o.ReadPermissionEveryone,o.CommentPermissionEveryone;function r(e){return e.id+" "+e.by}function s(e){var n=e.split(" ");return{id:+n[0],by:n[1]}}var a={id:0,title:"",theText:"",likes:0,retweets:[],comments:[],by:"",permissions:65535},c={id:0,title:"",theText:"",likes:0,retweets:[],comments:[],by:"",parent:"",permissions:65535},l=310607124441e3},144:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return a})),t.d(n,"b",(function(){return c}));var o=t(32),i=t(28),r=t(220),s=t.n(r),a=function e(n,t,o){Object(i.a)(this,e),this.message=void 0,this.topic=void 0,this.packet=void 0,this.message=n,this.topic=t,this.packet=o},c=function(){function n(t,o,r,a,c,l){var u=this;Object(i.a)(this,n),this.topic="",this.replyAddress=void 0,this.port=0,this.socket=void 0,this.owner=void 0,this.packetSentCount=0,this.packetSentSize=0,this.theLengthWeNeed=0,this.firstline="",this.params=void 0,this.finishSocket=function(){void 0!==u.socket&&u.socket.destroy()},this.client_on_close=function(){console.log("Socket Connection closed",u.firstline)},this.client_on_connect=function(){var n=e.from(u.params.message).indexOf("\n");n<=0&&(n=32),n>u.params.message.length&&(n=u.params.message.length);var t=e.from(u.params.message).toString("utf8").substr(0,n);console.log("Connected, sending initial request from packet",t),u.socket.write(u.params.message)},this.client_on_data=function(n){for(var t=e.from(n),o=[];;){var i=65535999934464;if(i>=t.length&&(i=t.length),o.push(t.slice(0,i)),0===(t=t.slice(i)).length)break}o.forEach((function(n){if(0===u.packetSentCount){var t=n.indexOf(e.from("\n"));u.firstline=n.slice(0,t).toString("utf8"),console.log("Socket data Received: "+u.firstline);var o=e.from("\r\n\r\n"),i=n.indexOf(o);if(i<=0)console.log("no header was found in first packet");else{var r=n.slice(0,i),s=e.from("Content-Length:"),a=r.indexOf(s);a<=0&&console.log("no Content-Length was found in first packet");var c=r.slice(a+s.length),l=e.from("\r\n"),f=c.indexOf(l),d=+c.slice(0,f).toString("utf8").trim();console.log("the Content length is ",d),u.theLengthWeNeed=d+r.length+4}}var h=n,p={retain:!0,qos:1,properties:{userProperties:{indx:""+u.packetSentCount},responseTopic:u.params.topic}};u.owner.client.publish(u.replyAddress,h,p),u.packetSentCount+=1,u.packetSentSize+=h.length,u.packetSentSize>=u.theLengthWeNeed&&(console.log("Publishing reply finished",u.firstline),u.finishSocket())}))},this.topic=o,this.replyAddress=r,this.owner=t,this.port=+c,this.params=l,this.socket=new s.a.Socket,this.socket.setTimeout(3e4,(function(){console.log("socket timed out socket timed out socket timed out socket timed out socket timed out "),u.finishSocket()})),this.socket.connect(this.port,a,this.client_on_connect),this.socket.on("data",this.client_on_data),this.socket.on("close",this.client_on_close)}return Object(o.a)(n,[{key:"go",value:function(){}}]),n}()}).call(this,t(9).Buffer)},19:function(e,n,t){"use strict";t.d(n,"b",(function(){return d})),t.d(n,"d",(function(){return g})),t.d(n,"c",(function(){return w})),t.d(n,"a",(function(){return k}));var o=t(10),i=t(28),r=t(32),s=t(9),a=t(122),c=t.n(a),l=t(144),u=t(3),f=t(11),d={keepalive:300,reschedulePings:!0,protocolId:"MQTT",protocol:"ws",protocolVersion:5,clean:!0,reconnectPeriod:4e3,connectTimeout:3e5,rejectUnauthorized:!1,clientId:"anyclient",username:"someuser",password:""},h=!1,p=new Map;function g(e,n){p.set(e,n)}var m=new Map,v=new Map;function b(e,n){v.set(e,n)}var w,y=function(){function e(n,t,r){var a,g,v,y=this;if(Object(i.a)(this,e),this.client=void 0,this.isClient=void 0,this.connectStatus=void 0,this.server_config=void 0,this.hashed2name=new Map,this.myReplyChannel=void 0,this.cleanerIntervalID=void 0,this.restartCallback=void 0,this.host=void 0,this.mqttOptions=void 0,this.successCallback=void 0,this.hooks=void 0,this.subscribeFunc=function(e){var n=e;n.startsWith("=")||(n=e.toLowerCase()),y.client.subscribe(n,{qos:0},(function(e){e?console.error("have error on subscribe ",e,n):console.log("subscribe ok ",n," aka ","="+u.c(n))}))},this.unsubscribeFunc=function(e){var n=e;n.startsWith("=")||(n=e.toLowerCase()),console.log("setting unsubscribe topic",n),y.client.unsubscribe(n,{qos:0},(function(e){e?console.error("have error on unsubscribe ",e,n):console.log("unsubscribe ok ",n)}))},this.setupClient=function(){y.client.on("connect",(function(){console.log(" Have on connect cb ");var e="";if(!y.client.connected)return console.log("ERROR ERROR Mqtt failed to connect to "+y.host+" with token. "),e="Mqtt failed to connect to "+y.host+" with token. ",y.successCallback(e),y.successCallback=function(){},void y.CloseTheConnect();y.client?(m.forEach((function(e,n){console.log("will now be subscribing to ",n,e)})),y.subscribeFunc(y.myReplyChannel),m.forEach((function(e,n){y.subscribeFunc(n)})),y.hooks.broasdcastSubscribeAll(),y.successCallback(""),y.successCallback=function(){}):(y.successCallback("mqtt client was null"),y.successCallback=function(){}),setTimeout((function(){y.sendAPing()}),500)})),y.client.on("error",(function(e){console.error("MQTT error: ",e),y.successCallback("MQTT error: "+e),y.successCallback=function(){},y.CloseTheConnect(),console.log("mqtt client ERROR RESTARTING err=",e),y.client.end((function(){console.log("Calling connect again2"),y.client=c.a.connect(y.host,y.mqttOptions),console.log("finished connect2 "),y.setupClient()}))})),y.client.on("failure",(function(e){console.error("MQTT failure: ",e),y.successCallback("MQTT failure: "+e),y.successCallback=function(){},y.CloseTheConnect()})),y.client.on("reconnect",(function(){console.log("MQTT Reconnecting "+new Date+" to "+y.host),y.subscribeFunc(y.myReplyChannel),m.forEach((function(e,n){y.subscribeFunc(n)})),y.hooks.broasdcastSubscribeAll()})),y.client.on("message",(function(e,n,t){var o=t.properties.responseTopic,i=u.e(t),r=i.get("api1");if(void 0!==r){var a=p.get(r);void 0!==a?(a.message=n,a.options=i,a.topic=e,a.returnAddress=o,a.permanent?f.b(y,r,a):(p.delete(r),f.c(y,r,a))):console.log("ERROR had api1 but unknown cmd. did you forget to 'load up the api with handlers for the various'? cmd was:",r)}else{var c=s.Buffer.from(n).toString("utf8");if(c.startsWith("GET ")){var d=y.hashed2name.get(e);if(d){var h=m.get(d);void 0===h&&(console.log("ERROR we really need to know a port for EVERY name ",d,e),h={host:"127.0.0.1",port:"9090"}),console.log("in the proxy route now",e);var g=new l.a(n,e,t);new l.b(y,e,o,h.host,h.port,g).go()}else console.log("failed to find topic in map",e,y.hashed2name),e===y.myReplyChannel&&console.log("myReplyChannel has a proxy request??",e,y.hashed2name),console.log("failed to find topic. Options:",i),console.log("failed to find topic. Message:",s.Buffer.from(n).toString("utf8"))}else console.log("Spooky: Have unknown packet. not api1 and not GET ",e,c)}}))},this.handleMqttConnect=function(e,n,t){console.log("have handleMqttConnect only call this ONCE",e),y.successCallback=t,n.password=y.server_config.token,n.clientId="someweirdclientid2345",n.username="someuser2345",n.protocol="ws",e="ws://"+e+"/mqtt",y.host=e,y.mqttOptions=n,y.client=c.a.connect(e,n),console.log("host ",e),y.client?y.setupClient():console.error("ERROR client was null")},this.handleDisconnect=function(){console.log("ERROR   !!!   have handleDisconnect "),y.client&&y.client.end((function(){y.client=null,console.log("finished disconnect ")}))},this.restartCallback=r,this.host="later",this.mqttOptions=d,this.successCallback=function(e){},this.hooks=t,this.server_config=n.config,this.cleanerIntervalID=setInterval((function(){!function(e){if(void 0!==w){e.broadcast_CleanOldItems();var n=[];p.forEach((function(e,t){var o=u.l();e.permanent||e.when+15e3<o&&n.push(t)})),n.forEach((function(e){if(void 0!==w){var n=p.get(e);if(void 0!==n){console.log("cleaning ",e);var t="ERROR ERROR timeout error "+e;n.waitingCallbackFn(n,t),p.delete(e)}}}))}}(t)}),1e3),this.myReplyChannel="="+u.x(32),this.isClient=n.isClient,!1===n.isClient){var k,O=Object(o.a)(n.config.items);try{for(O.s();!(k=O.n()).done;){var j=k.value,C={host:j.host||"127.0.0.1",port:j.port};a=j.name.toLowerCase(),g=C.host,v=C.port,console.log("setting topic2portset ",a,g,v),m.set(a,{host:g,port:v}),b(j.name.toLowerCase(),j.directory)}}catch(P){O.e(P)}finally{O.f()}m.forEach((function(e,n){var t=u.c(n.toLowerCase());t="="+t,y.hashed2name.set(t,n.toLowerCase())}));var x,S=Object(o.a)(t.api_getAllHooks());try{for(S.s();!(x=S.n()).done;){var R=x.value;p.set(R.id,R)}}catch(P){S.e(P)}finally{S.f()}}else{R=t.eventapi_getWr();p.set(R.id,R),R=t.pingapi_getWr(),p.set(R.id,R)}this.connectStatus="closed";console.log("initializing ping setInterval"),!1===h&&setInterval((function(){y.sendAPing()}),3e4),h=!0,this.client=null}return Object(r.a)(e,[{key:"sendAPing",value:function(){var e=this;console.log("mqtt ping"),this.hooks.do_ping((function(n){void 0!=n&&!0!==e.isClient&&(console.log("mqtt client ping ERROR RESTARTING err=",n),e.client.end((function(){console.log("Calling connect again"),e.client=c.a.connect(e.host,e.mqttOptions),console.log("finished connect "),e.setupClient()})))}))}},{key:"CloseTheConnect",value:function(){}}]),e}();function k(e,n){w=new y(e,n,(function(){console.log("RE-StartClientMqtt called"),console.log("RE-StartClientMqtt called"),console.log("RE-StartClientMqtt called")}))}},22:function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return s}));var o=t(10),i={name:"",nameReservationToken:"",port:"",directory:"",passphrase:[],host:"localhost"},r={token:"dummy",items:[]};function s(e){var n,t=Object(o.a)(r.items);try{for(t.s();!(n=t.n()).done;){var s=n.value;if(s.name===e)return s}}catch(a){t.e(a)}finally{t.f()}return i}},221:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));t(10),t(8),t(9),t(22),t(3);function o(e){e}},252:function(e,n,t){},253:function(e,n,t){},3:function(e,n,t){"use strict";t.d(n,"y",(function(){return p})),t.d(n,"h",(function(){return m})),t.d(n,"s",(function(){return b})),t.d(n,"m",(function(){return w})),t.d(n,"t",(function(){return y})),t.d(n,"o",(function(){return k})),t.d(n,"k",(function(){return O})),t.d(n,"g",(function(){return j})),t.d(n,"w",(function(){return C})),t.d(n,"u",(function(){return x})),t.d(n,"f",(function(){return S})),t.d(n,"l",(function(){return A})),t.d(n,"p",(function(){return T})),t.d(n,"j",(function(){return F})),t.d(n,"x",(function(){return M})),t.d(n,"z",(function(){return G})),t.d(n,"i",(function(){return N})),t.d(n,"a",(function(){return E})),t.d(n,"d",(function(){return I})),t.d(n,"c",(function(){return J})),t.d(n,"b",(function(){return W})),t.d(n,"n",(function(){return _})),t.d(n,"q",(function(){return U})),t.d(n,"r",(function(){return D})),t.d(n,"e",(function(){return K})),t.d(n,"v",(function(){return B}));for(var o=t(10),i=t(66),r=t(9),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",a=r.Buffer.alloc(128),c=0;c<a.length;c++)a[c]=0;for(c=0;c<s.length;c++){var l=s.charCodeAt(c);a[l]=c}function u(e){for(var n=r.Buffer.alloc(Math.floor(3*e.length/4)),t=0,o=0;o<e.length;){var i=a[e.charCodeAt(o)],s=(o+=1)<e.length?a[e.charCodeAt(o)]:0,c=(o+=1)<e.length?a[e.charCodeAt(o)]:0,l=(o+=1)<e.length?a[e.charCodeAt(o)]:0;o+=1;var u=(((i<<6)+s<<6)+c<<6)+l;n[t++]=u>>16,t<n.length&&(n[t++]=u>>8),t<n.length&&(n[t++]=u)}return n}var f=t(219),d=t.n(f),h=t(13),p="Anonymous",g=!1;var m={username:"",password:[],tokenFromApp:"",initialized:!1,unfamiliar:!1,ourPublicKey:[],ourSecretKey:[],profileHash:""},v=[];function b(){var e=w(p);return e||(console.log("getSignedInContext fail. was hoping to avoid this."),m)}function w(e,n){var t,i=Object(o.a)(v);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(x(r),r.username.toLowerCase()===e.toLowerCase())return r}}catch(s){i.e(s)}finally{i.f()}return!0!==n&&console.log("getNameToContext fail. was hoping to avoid this.",e),m}function y(e){return e.startsWith("=")?function(e){var n,t=Object(o.a)(v);try{for(t.s();!(n=t.n()).done;){var i=n.value;if(x(i),i.profileHash===e)return i}}catch(r){t.e(r)}finally{t.f()}return console.log("getMatchingHashedTopicContext fail. was hoping to avoid this."),m}(e).username:e}function k(e){var n,t=Object(o.a)(v);try{for(t.s();!(n=t.n()).done;){var i=n.value;x(i);for(var r=0;r<i.ourPublicKey.length;r++)if(i.ourPublicKey[r]===e)return i.username}}catch(s){t.e(s)}finally{t.f()}return G(e)}function O(e){e.startsWith("=")||console.log("ERROR expecting HASHED topic ",e);var n,t=Object(o.a)(v);try{for(t.s();!(n=t.n()).done;){var i=n.value;if(x(i),i.profileHash===e)return i}}catch(r){t.e(r)}finally{t.f()}return console.log("getHashedTopic2Context fail. was hoping to avoid this.",e),m}function j(){v=[]}function C(e){var n,t=Object(o.a)(v);try{for(t.s();!(n=t.n()).done;){if(n.value.username===e.username)return}}catch(i){t.e(i)}finally{t.f()}v.push(e)}function x(e){if(!e.initialized){if(0!==e.password.length){e.ourPublicKey=[],e.ourSecretKey=[];for(var n=0;n<e.password.length;n++){var t=P(e.username,e.password[n]);e.ourPublicKey.push(r.Buffer.from(t.publicKey)),e.ourSecretKey.push(r.Buffer.from(t.secretKey))}}e.profileHash="="+J(e.username.toLowerCase()),e.initialized=!0}}function S(e){if(e.length<200)return["","token is too short to be a token"];console.log("about to verify the token");for(var n=0,t=0,o=0,i=0;i<e.length;i++){var r=e[i];if(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||"-"===r||"_"===r||"."===r)i-n>o-t&&(t=n,o=i);else n=i+1}var s=e.substring(t,o+1).split(".");if(3!==s.length)return["","Token needs 3 periods"];var a=u(s[1]).toString("utf8");console.log("verify the token found ",a);var c=JSON.parse(a)||{};return void 0!==c.url?[c.url,""]:(console.log("expected  ",a),["","expected 'url' in token "])}function R(e){var n=r.Buffer.from(e);return d()(n)}function P(e,n){var t=R(e+n);return i.c(t)}function A(){return(new Date).getTime()}function T(){var e=A(),n=e%1e3;return":"+(e=Math.floor(e/1e3))%60+"."+n}function F(){return q(A())}function M(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",o=0;o<e;o++){var i=Math.floor(Math.random()*n.length);t+=n.substring(i,i+1)}return t}function G(e){return function(e){for(var n=r.Buffer.alloc(Math.floor(4*e.length/3+.999)),t=0,o=0;o<e.length;){var i=e[o],a=(o+=1)<e.length?e[o]:0,c=(o+=1)<e.length?e[o]:0;o+=1;var l=0,u=i>>2;l=s.charCodeAt(u),n[t++]=l,l=s.charCodeAt(u=((3&i)<<4)+(a>>4)),n[t++]=l,l=s.charCodeAt(u=((15&a)<<2)+(c>>6)),n[t++]=l,l=s.charCodeAt(u=63&c),n[t++]=l}return n.toString("utf8")}(e)}function N(e){return u(e)}function E(e,n,t,o){var s=o,a=i.a(e,n,t,s);return r.Buffer.from(a)}function I(e,n,t,o){var s=t,a=o,c=i.d(e,n,s,a);return r.Buffer.from(c||r.Buffer.from(""))}function J(e){var n=G(r.Buffer.from(R(e)));return n=n.slice(0,32)}function q(e){var n=new Date(e),t=n.getDate(),o=n.getMonth()+1,i=n.getFullYear(),r=+(i%=100);return r=1e3*(r=100*(r=100*(r=100*(r=100*(r=100*r+o)+t)+n.getHours())+n.getMinutes())+n.getSeconds())+(e%=1e3)}function W(e){var n=e;n=Math.floor(n/1e3);var t=(n=Math.floor(n/100))%100,o=(n=Math.floor(n/100))%100,i=(n=Math.floor(n/100))%100;return(n=Math.floor(n/100))%100+"/"+i+"/"+(n=Math.floor(n/100))%100+" "+o+":"+t}function _(){var e="unknown",n=g?"http://dummy.knotlocal.com:8085/":window.location.href,t=n.indexOf("//");if(t>0){var o=(n=n.substring(t+2)).split(".");if(o.length<=0&&console.log("how can we have missing parts here?"),o.length<=2)return"";e=o[0]}return e}function L(){var e="unknown",n=g?"http://dummy.knotlocal.com:8085/":window.location.href,t=n.indexOf("//");if(t>0){var o=(n=n.substring(t+2)).split(".");if(o.length<=0&&console.log("how can we have missing parts here?"),o.length<=2)return n;e=o[1]+"."+o[2]}return e}function U(){var e=L(),n=e.indexOf("/");return n>=0&&(e=e.slice(0,n)),e}function D(){var e=L(),n=e.indexOf("/");return e=n>=0?e.slice(n+1):""}function K(e){var n=new Map;return Object.keys(e.properties.userProperties).forEach((function(t){var o=e.properties.userProperties[t];if(o){var i=o.toString();"["===i[0]&&(i=i.substr(1)),"]"===i[i.length-1]&&(i=i.substr(0,i.length-1)),n.set(t,i)}})),n}function B(e){return{id:0,title:"",theText:"",likes:0,retweets:[],comments:[],by:e,permissions:h.a}}},34:function(e,n,t){"use strict";t.d(n,"d",(function(){return s})),t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return c})),t.d(n,"e",(function(){return l})),t.d(n,"a",(function(){return u}));var o=t(19),i=(t(78),t(3)),r=new Map;function s(){r.forEach((function(e,n,t){void 0!==o.c?o.c.subscribeFunc(e.name):console.log("ERROR SubscribeAll no mqtt")}))}function a(e){var n=e.who;n.startsWith("=")&&console.log("ERROR names cannot be alieases here. no starts with ="),n=n.toLowerCase()+"_broadcast";var t=r.get(n);void 0!==t&&t.receivers.forEach((function(n){n.receiver(e)}))}function c(e,n,t){e.startsWith("=")&&console.log("ERROR names cannot be alieases here. no starts with ="),e=e.toLowerCase()+"_broadcast";var s=r.get(e);void 0===s&&(s={name:e,receivers:[],when:i.l()},r.set(e,s));for(var a=-1,c=0;c<s.receivers.length;c++){s.receivers[c].rname===n&&(a=c)}a>=0&&s.receivers.splice(a,1);var l={rname:n,receiver:t};s.receivers.push(l),1===s.receivers.length&&a<0&&(void 0!==o.c?o.c.subscribeFunc(e):console.log("ERROR Subscribe no mqtt"))}function l(e,n){e.startsWith("=")&&console.log("ERROR names cannot be alieases here. can't start with ="),e=e.toLowerCase()+"_broadcast";var t=r.get(e);if(void 0!==t){for(var o=-1,s=0;s<t.receivers.length;s++){t.receivers[s].rname===n&&(o=s)}o>=0&&t.receivers.splice(o,1),0===t.receivers.length&&(t.when=i.l())}}function u(){if(void 0!==o.c){var e=[],n=i.l();r.forEach((function(t,o,i){0===t.receivers.length&&n-t.when>2e3&&e.push(o)}));for(var t=0;t<e.length;t++){var s=e[t];o.c.unsubscribeFunc(s),r.delete(s)}}else console.log("ERROR CleanOldItems no mqtt")}},363:function(e,n){},365:function(e,n){},37:function(e,n,t){"use strict";(function(e){t.d(n,"d",(function(){return a})),t.d(n,"b",(function(){return c})),t.d(n,"a",(function(){return l})),t.d(n,"c",(function(){return u})),t.d(n,"e",(function(){return d}));var o,i=t(11),r=t(3),s=t(22);function a(e){o=e}var c=new Map,l={cmd:"getFriends",friends:[],followers:[],following:[],blocked:[],name2keys:new Map};function u(e,n,t,o){setTimeout((function(){!function(e,n,t,o){var r={cmd:"getFriends",count:n,offset:t},s=JSON.stringify(r),a=f;i.d(a,e,s,(function(i,r){var s=(new TextDecoder).decode(i);if(console.log("getFriends return err=",r),void 0!==r)console.log("GetFriends SendApiCommandOut error, retrying ",e),setTimeout((function(){u(e,n,t,o)}),5e3);else{var a=s.length>0?JSON.parse(s,p):{};o(a,r)}}))}(e,n,t,o)}),10)}var f={id:"getFriends",when:r.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleGetFriendsApi with ",r.t(n.topic),n.message.toString());var a=JSON.parse(n.message.toString()).count,c=r.k(n.topic)||r.h,u="data/"+s.a(c.username).directory;if(0!==a){var f=l,d=0;d+=1,o.readFile(u+"friends.txt",(function(e,n){e?console.log(" read friends error "+u,e):f.friends=n.toString("utf8").split("\n"),p()})),d+=1,o.readFile(u+"followers.txt",(function(e,n){e?console.log(" read followers error "+u,e):f.followers=n.toString("utf8").split("\n"),p()})),d+=1,o.readFile(u+"following.txt",(function(e,n){e?console.log(" read following error "+u,e):f.following=n.toString("utf8").split("\n"),p()})),d+=1,o.readFile(u+"blocks.txt",(function(e,n){e?console.log(" read blocked error "+u,e):f.blocked=n.toString("utf8").split("\n"),p()})),d+=1,o.readFile(u+"key.txt",(function(e,n){e?console.log(" read key error "+u,e):n.toString("utf8").split("\n").forEach((function(e){var n=e.split(" "),t=n[0],o=n.slice(1);f.name2keys.set(t,o)}));p()}));var p=function(){if((d-=1)<=0){var t=JSON.stringify(f,h);Object(i.e)(n,e.from(t),null)}}}},options:new Map,returnAddress:"unused now"};function d(){return f}function h(e,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n}function p(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}}).call(this,t(9).Buffer)},381:function(e,n){},383:function(e,n){},39:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return m})),t.d(n,"a",(function(){return v})),t.d(n,"c",(function(){return y}));var o,i=t(8),r=t(10),s=t(28),a=t(32),c=t(84),l=t(83),u=t(13),f=t(11),d=t(3),h=t(22),p=t(37),g=t(57);function m(e){o=e}var v=new(function(e){Object(c.a)(t,e);var n=Object(l.a)(t);function t(){return Object(s.a)(this,t),n.apply(this,arguments)}return Object(a.a)(t,[{key:"keyofN",value:function(e){return u.d(e)}},{key:"keyofG",value:function(e){return u.d(e)}},{key:"useTheApi",value:function(e,n,t){var o=this;!function(e,n){var t,o=new Map,s=Object(r.a)(e);try{for(s.s();!(t=s.n()).done;){var a=t.value,c=o.get(a.by)||[];c.push(a),o.set(a.by,c)}}catch(l){s.e(l)}finally{s.f()}o.forEach((function(e,t,o){var r=t.toLowerCase();console.log("top of getComments api pubk search");var s=d.m(r,!0);if(0===s.ourPublicKey.length){if(s.username!=r){var a=Object(i.a)(Object(i.a)({},d.h),{},{username:r});d.w(a),s=d.m(r,!0)}var c=p.b.get(d.n());if(void 0!=c){var l=c.name2keys.get(r);void 0!==l&&(s.ourPublicKey=[d.i(l[0]),d.i(l[1])])}g.a(d.y,r,(function(o,i){i?(console.log("getComments ping failed ",r,i),n([],"getComments ping failed "+r+i)):(s.ourPublicKey=[d.i(o.pub)],s.unfamiliar=!0,b(t,e,n))}))}else b(t,e,n)}))}(n,(function(n,i){if(i)console.log("ERROR CommentGetterClass useTheApi commentsReceiver has error",i);else{var s,a=o.getClient(e),c=Object(r.a)(n);try{for(c.s();!(s=c.n()).done;){var l=s.value,u=o.keyofG(l);a.pending.delete(u)}}catch(f){c.e(f)}finally{c.f()}t(n)}}))}}]),t}(t(79).a));function b(e,n,t){var o={cmd:"GetComments",refs:n},i=JSON.stringify(o),r=w;f.d(r,e,i,(function(o,i){var r=(new TextDecoder).decode(o);console.log("GetComments have comments back ",i);var s=r.length>0?JSON.parse(r):[];void 0!==i?(console.log("GetComments SendApiCommandOut timed out, retrying ",e),setTimeout((function(){console.log("GetComments SendApiCommandOut timer done. IssueTheCommand AGAIN. "),b(e,n,t)}),1e3)):(console.log("GetComments SendApiCommandOut receiver "),t(s,i))}))}var w={id:"GetComments",when:d.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleGetCommentApi with ",d.t(n.topic),n.message.toString(),d.p());var s=JSON.parse(n.message.toString()),a=d.k(n.topic),c=h.a(a.username),l="data/"+c.directory+"lists/comments/",p="data/"+c.directory+"lists/posts/";o.mkdirs(l,o.dummyCb);var g,m=s.refs.length,v=0,b=[],w=Object(r.a)(s.refs);try{var y=function(){var t=g.value,r=(""+t.id).substr(0,6);k=l+r+"/"+t.id;var s=p+r+"/"+t.id;(O=Object(i.a)({},u.e)).id=t.id,o.readFile(k,(function(i,r){if(v+=1,i)o.readFile(s,(function(o,i){if(o)O.title="Oops...",O.theText="We don't seem to be able to find this comment. Perhaps it was deleted. <sub>Err code:"+o+"<</sub> ";else{var r=e.from(i).toString("utf8");try{var s=JSON.parse(r);O=s}catch(c){console.log("GetComments ERROR bad json",r),O.title="Load fail: ERROR bad json from "+k,O.theText=r,O.id=t.id,O.by=t.by}}if(b.push(O),v>=m){var a=JSON.stringify(b);Object(f.e)(n,e.from(a),null)}}));else{var a=e.from(r).toString("utf8");try{var c=JSON.parse(a);O=c}catch(u){console.log("GetComments ERROR bad json",a),O.title="Load fail: ERROR bad json from "+k,O.theText=a,O.id=t.id,O.by=t.by}}if(b.push(O),v>=m){var l=JSON.stringify(b);Object(f.e)(n,e.from(l),null)}}))};for(w.s();!(g=w.n()).done;){var k,O;y()}}catch(t){w.e(t)}finally{w.f()}},options:new Map,returnAddress:"unused now"};function y(){return w}}).call(this,t(9).Buffer)},408:function(e,n){},409:function(e,n){},411:function(e,n){},413:function(e,n){},430:function(e,n,t){"use strict";t.r(n);var o=t(0),i=t.n(o),r=t(18),s=t.n(r),a=(t(252),t(10),t(15)),c=(t(253),t(464)),l=t(485),u=t(478),f=t(473),d=(t(479),t(486),t(472),t(487),t(229),t(474),t(484)),h=(t(81),t(112),t(1));Object(c.a)((function(e){return Object(l.a)({root:{display:"flex",alignItems:"center",justifyContent:"center",margin:"20 20px",padding:"20 20px",width:e.spacing(50),height:e.spacing(75),minWidth:200,font:"Ubuntu",flexDirection:"column",textAlign:"center"}})})),t(8),t(466),t(468),t(471),t(480),t(481),t(96),Object(c.a)((function(e){return Object(l.a)({root:{display:"flex",alignItems:"center",justifyContent:"center",margin:"20 20px",padding:"20 20px",width:e.spacing(50),height:e.spacing(50),minWidth:e.spacing(50),textAlign:"center"}})}));var p=t(64),g=(t(34),t(3));Object(c.a)((function(e){return Object(l.a)({thebox:{fontSize:13},thecard:{display:"flex",padding:"8px 8px",margin:"8px 8px",flexDirection:"column"}})})),p.a,g.x(16),t(13);Object(c.a)((function(e){return Object(l.a)({root:{margin:"12 12px"},editdialog:{margin:"2 2px",padding:"20 20px",width:800,height:800,minWidth:800},editgeneral:{flexGrow:1,height:800,justifyContent:"center",alignItems:"center",margin:"2 2px",padding:"20 20px"},aboutdialog:{}})}));var m=t(82),v=t(233);t(230),t(476),t(482),t(477),t(99),t(118),t(475),t(488),t(224),t(225),t(97),Object(c.a)((function(e){return Object(l.a)({root:{flexGrow:1,height:800}})})),Object(c.a)((function(e){return Object(l.a)({editdialog:{flexGrow:1,margin:"2 2px",padding:"20 20px",width:800,height:800,minWidth:800},button:{margin:"0px 0px",padding:"0px 0px",height:"40",width:"32px"}})})),t(98),Object(c.a)((function(e){return Object(l.a)({root:{},theTextStyle:{display:"flex",padding:"0px 0px",height:120,overflow:"auto",flexDirection:"column"},nopadding:{padding:"0px 0px"},pushedright:{display:"flex",justifyContent:"space-between"},centered:{display:"flex",justifyContent:"space-between",fontSize:11,alignItems:"center"},button:{margin:"0px 0px",padding:"0px 0px",height:"20",width:"20"}})})),t(39),t(65),Object(c.a)((function(e){return Object(l.a)({root:{margin:"0 11px",border:"0 12px",padding:"0 13px"},wrapper:{overflow:"auto",maxHeight:e.spacing(94)},evens:{},odds:{}})})),new Map,new Map,new Map,g.x(16);t(47),Object(c.a)((function(e){return Object(l.a)({root:{margin:"0 11px",border:"0 12px",padding:"0 13px"},wrapper:{overflow:"auto",maxHeight:e.spacing(94)},evens:{},odds:{}})})),new Map,new Map,new Map,g.x(16);Object(c.a)((function(e){return{root:{flexGrow:1,height:18,backgroundColor:e.palette.background.paper},tabLabel:{fontSize:14,height:18,textTransform:"capitalize"},tabPanel:{height:e.spacing(50),width:"100%"}}})),t(226),Object(c.a)((function(e){return Object(l.a)({root:{display:"flex",margin:"2 2px",border:"2 2px",padding:"0px 0px",alignItems:"center",justifyContent:"center"}})})),t(37),Object(c.a)((function(e){return{root:{flexGrow:1,height:12,backgroundColor:e.palette.background.paper,padding:"0px 0px",justifyContent:"center",alignItems:"center"},showingstyle:{textTransform:"capitalize",justifyContent:"center",alignItems:"center",fontSize:16,fontWeight:"bold",boxShadow:"0",margin:"24 0px",border:"24 0px"},friendItem:{margin:0,textTransform:"none",fontSize:12,fontFamily:"Noto Serif"},tabLabel:{fontSize:12,height:14,textTransform:"capitalize"},tabs:{width:"auto",backgroundColor:"green"}}})),Object(c.a)((function(e){return Object(l.a)({root:{flexGrow:1,minWidth:e.spacing(16)},avatar:{flexGrow:1,width:200,height:200,justifyContent:"center",alignItems:"center"},leftDivTop:{width:"100%",height:e.spacing(50),minWidth:200},leftDivBot:{width:"100%",height:e.spacing(50),minWidth:e.spacing(16)},rightDiv:{width:"100%",height:e.spacing(100),minWidth:e.spacing(16)}})})),Object(u.a)({breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}}}),Object(c.a)((function(e){return Object(l.a)({paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary,minHeight:"100%"},paperLeft:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary},avatar:{flexGrow:1,width:75,height:75,justifyContent:"center",alignItems:"center"}})}));var b=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,490)).then((function(n){var t=n.getCLS,o=n.getFID,i=n.getFCP,r=n.getLCP,s=n.getTTFB;t(e),o(e),i(e),r(e),s(e)}))},w=t(44),y=t(227),k=t(119),O=function(e){var n=g.q(),t="http://"+n;t=t.replace("3000","8085");var o=i.a.useState(""),r=Object(a.a)(o,2),s=r[0],c=r[1];console.log("PalPalDialog serverName",n),w.a.event({category:"User",action:"In PayPal with "+n});var l=function(){var e=window.URL.createObjectURL(new Blob([s],{type:"application/octet-stream"}));return Object(h.jsx)("a",{href:e,download:"KnotFree32xlargeToken.txt",children:"Download as file."})};return Object(h.jsx)("div",{style:{width:500,height:700,padding:24},children:Object(h.jsxs)("div",{style:{width:400,height:400,padding:12},children:[Object(h.jsx)("h3",{children:e.title}),"For $5 you will receive a monster, 5xlarge, token which is enough for a small village and doesn't expire for 12 months..",Object(h.jsx)(y.PayPalButton,{amount:"5.00",shippingPreference:"NO_SHIPPING",style:{height:30,width:256},onSuccess:function(e,n){console.log("Transaction completed by "+e.payer.name.given_name," data is ",n),fetch(t+"/api1/paypal-transaction-complete",{method:"post",body:JSON.stringify({orderID:n.orderID,payerID:n.payerID,raw:n})}).then((function(e){console.log("have get buy token response ",e),e.ok&&e.text().then((function(e){console.log("have get buy token fetch result ",e),c(e),m.c("knotfree_access_token_v2",e)}))}))},options:{clientId:"AV0OVlxl84D_i5XxkhbJWYLEJKj1S03A-shkckJjLC9RBTXyHvUhGG0KCnPcSqtVOp_c7u5_5U3Qzkmi"}}),""!=s?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("h2",{children:"Here is your token! You should save it in a safe place. Click on 'Download'."}),Object(h.jsx)(v.a,{children:s}),Object(h.jsx)("div",{style:{padding:12},children:Object(h.jsx)(k.CopyToClipboard,{text:s,onCopy:function(){return console.log("theToken copied to clipboard")},children:Object(h.jsx)("button",{children:"Copy to clipboard."})})}),Object(h.jsx)("div",{style:{padding:24},children:l()})]}):Object(h.jsx)(h.Fragment,{})]})})},j=function(e){var n=g.q(),t=i.a.useState(""),r=Object(a.a)(t,2),s=r[0],c=r[1],l=i.a.useState(!1),u=Object(a.a)(l,2),f=u[0],d=u[1];console.log("PalPalDialog serverName",n),Object(o.useEffect)((function(){if(!f&&""===s){d(!0);var e=g.q();m.b(e,(function(e,n){e&&(c(n),d(!1))}))}}),[f,s]),w.a.event({category:"User",action:"In FreeToken with "+n});var p=function(){var e=window.URL.createObjectURL(new Blob([s],{type:"application/octet-stream"}));return Object(h.jsx)("a",{href:e,download:"KnotFree32xlargeToken.txt",children:"Download as file."})};return Object(h.jsx)("div",{style:{width:500,height:700,padding:24},children:Object(h.jsxs)("div",{style:{width:400,height:400,padding:12},children:[Object(h.jsx)("h3",{children:e.title}),"For free! you will receive a tiny, x-small, token which is barely enough for light use by one person. It expires in 30 days. It's worth $0.00168 or about 2 cents per year.",""!==s?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("h2",{children:"Here is your token! You should save it in a safe place. Click on 'Download as file'."}),Object(h.jsx)(v.a,{children:s}),Object(h.jsx)("div",{style:{padding:12},children:Object(h.jsx)(k.CopyToClipboard,{text:s,onCopy:function(){return console.log("theToken copied to clipboard")},children:Object(h.jsx)("button",{children:"Copy to clipboard."})})}),Object(h.jsx)("div",{style:{padding:24},children:p()})]}):Object(h.jsx)(h.Fragment,{})]})})};t(228);w.a.initialize("UA-198012996-1",{titleCase:!1,gaOptions:{siteSpeedSampleRate:100}}),w.a.pageview(window.location.pathname+window.location.search+"knotfree");var C=Object(c.a)((function(e){return Object(l.a)({root:{flex:1,width:e.spacing(50),height:e.spacing(75),top:"10%",left:"10%",position:"absolute"},divstyle:{padding:20,backgroundColor:"rgba(250, 250, 250, 0.95)",width:"80vw"}})})),x=(g.x(16),{backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",width:"100vw",height:"100vh"}),S=function(e){var n=i.a.useState(!1),t=Object(a.a)(n,2),o=t[0],r=t[1],s=i.a.useState(!1),c=Object(a.a)(s,2),l=c[0],u=c[1],p=C(),m=g.r();console.log(" in KnotFreeApp page is ",m);var v=function(){r(!1),u(!1)},b=function(){console.log("setGetFreeToken(true)"),u(!0)},w=function(e,n){return Object(h.jsx)("button",{style:{border:"none",fontSize:13},onClick:n,children:e})};return Object(h.jsxs)("div",{style:x,children:[Object(h.jsx)(f.a,{className:p.root,container:!0,direction:"column",component:"div",children:Object(h.jsxs)("div",{children:[Object(h.jsx)("h3",{children:"KnotFree.net  "}),Object(h.jsx)("a",{href:"https://medium.com/@alantraceywootton/why-we-need-a-new-internet-and-how-to-get-one-3bd8cfa35530",children:" Why we need a new Internet and how to get one."}),Object(h.jsx)("p",{children:"The knot free net consists of network services. This webpage is just the tip of the iceberg."}),Object(h.jsx)("p",{children:"There are MQTT services at this address. MQTT over websocket on port 80 and MQTT 3 and 5 on the usual MQTT port 1883"}),Object(h.jsxs)("p",{children:["Use a 'token' as the password ",w("(available here)",b),". Wildcard subscriptions and QOS are not supported."]}),Object(h.jsx)("p",{children:"Instead of requiring registration with an email address, which is much too heavy for most situations, it runs on crypto 'tokens'. Think of arcade tokens only much cheaper. Think of an NFT with a non crazy price."}),Object(h.jsxs)("p",{children:["Having direct secure communication between smart appliances, devices, or 'things' and your phone is going to require a new internet. This one: the knot free net.",Object(h.jsx)("a",{href:"https://medium.com/@alantraceywootton/why-we-need-a-new-internet-and-how-to-get-one-3bd8cfa35530",children:" See this essay. "}),"The cheap, and weak, free tokens expire in months but more powerful and long lived tokens are available."]}),Object(h.jsxs)("p",{children:["You can ",w("buy a token here",(function(){r(!0)}))," and the small ones are being ",w("given out gratis",b),"."]}),Object(h.jsx)("p",{children:Object(h.jsx)("a",{href:"https://github.com/awootton/knotfreeiot",children:"All the code is open source"})}),Object(h.jsxs)("p",{children:["Those who know about mqtt (one of the services) and ports and addresses",Object(h.jsx)("a",{href:"https://github.com/awootton/GoToHere/wiki/KnotFree.net-ports-and-services",children:" should check out the technical documentation"})]}),"Later we'll have some examples for arduino and other uses."]})}),Object(h.jsx)(d.a,{style:{width:600,height:800,padding:24},className:p.root,open:o,onClose:v,children:Object(h.jsx)(O,{title:"Please buy a token here. Computers aren't free."})}),Object(h.jsx)(d.a,{style:{width:600,height:800,padding:24},className:p.root,open:l,onClose:v,children:Object(h.jsx)(j,{title:"This page will dispense a free token."})})]})};w.a.initialize("UA-198012996-1",{titleCase:!1,gaOptions:{siteSpeedSampleRate:100}}),w.a.pageview(window.location.pathname+window.location.search+g.n()),s.a.render(Object(h.jsx)(i.a.StrictMode,{children:function(){if(console.log("index getApp starting ",g.n()),""===g.n()){var e=g.q();return e.startsWith("goto")||e.startsWith("knot"),Object(h.jsx)(S,{})}return Object(h.jsx)(S,{})}()}),document.getElementById("root")),b()},47:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return h})),t.d(n,"a",(function(){return p})),t.d(n,"c",(function(){return v}));var o,i=t(10),r=t(28),s=t(32),a=t(84),c=t(83),l=t(11),u=t(80),f=t(3),d=t(22);function h(e){o=e}var p=new(function(e){Object(a.a)(t,e);var n=Object(c.a)(t);function t(){return Object(r.a)(this,t),n.apply(this,arguments)}return Object(s.a)(t,[{key:"keyofN",value:function(e){return e.when+" "+e.username}},{key:"keyofG",value:function(e){return e.when+" "+e.username}},{key:"useTheApi",value:function(e,n,t){var o,r=this,s=function(n,o){if(o)console.log("ERROR useTheApi postsListReceiver has error",o);else{var s,a=r.getClient(e),c=Object(i.a)(n);try{for(c.s();!(s=c.n()).done;){var l=s.value;a.pending.delete(r.keyofG(l))}}catch(u){c.e(u)}finally{c.f()}t(n)}},a=Object(i.a)(n);try{for(a.s();!(o=a.n()).done;){g(o.value,s)}}catch(c){a.e(c)}finally{a.f()}}}]),t}(t(79).a));function g(e,n){var t={cmd:"getPosts",top:e.when,count:e.amt},o=JSON.stringify(t),i=m;l.d(i,e.username,o,(function(t,o){var i=(new TextDecoder).decode(t);console.log("GetPostsCmd returns w err ",o);var r=i.length>0?JSON.parse(i):[];void 0!==o?(console.log("GetPostsCmd SendApiCommandOut have error,user ",o,e.username,f.p()),setTimeout((function(){console.log("GetPostsCmd SendApiCommandOut timer done. IssueTheCommand AGAIN. "),g(e,n)}),9e3)):n([r],o)}))}var m={id:"getPosts",when:f.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleGetPostApi with ",f.t(n.topic)," key id ",n.options.get("nonc"),f.p());var i=JSON.parse(n.message.toString()),r=f.k(n.topic),s="data/"+d.a(r.username).directory+"lists/posts/";if(o.mkdirs(s,o.dummyCb),0!==i.count){var a=[],c=!1,h={countNeeded:i.count,newer:""+i.top,basePath:s,haveOne:function(t){if(c)return a.length;var o=JSON.parse(t.toString("utf8"));if(a.push(o),a.length>=i.count&&!1===c){var s={username:r.username,when:i.top,posts:a},u=JSON.stringify(s);Object(l.e)(n,e.from(u),null),c=!0}return a.length},done:!1};u.b(h)}},options:new Map,returnAddress:"unused now"};function v(){return m}}).call(this,t(9).Buffer)},57:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return s})),t.d(n,"c",(function(){return c}));var o=t(11),i=t(3);function r(e){s("Anonymous","Anonymous",(function(n,t){console.log("mqtt client ping receiver",t?"ERROR:"+t:"OK"),e(t)}))}function s(e,n,t){e=e.toLowerCase();var r=i.m(e),s={cmd:"ping",pub:i.z(r.ourPublicKey[0])},c=JSON.stringify(s),l=a,u=n;console.log(" Ping IssueTheCommand using topic ",u,e,n),o.d(l,u,c,(function(e,n){var o=(new TextDecoder).decode(e);if(n||0===o.length)s.pub=n,t(s,n);else{var i=JSON.parse(o);t(i,n)}}))}var a={id:"ping",when:i.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){var r=i.k(n.topic);console.log("in the handlePingApi with ",n.topic,n.message.toString(),i.c("alice_vociferous_mcgrath"));var s=JSON.parse(n.message.toString());s.pub=i.z(r.ourPublicKey[0]);var a=JSON.stringify(s);Object(o.e)(n,e.from(a),null)},options:new Map,returnAddress:"unused now",isPing:!0};function c(){return a}}).call(this,t(9).Buffer)},64:function(e,n,t){"use strict";(function(e){t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return l})),t.d(n,"d",(function(){return f}));var o,i=t(11),r=t(3),s=t(22);function a(e){o=e}var c={image:"http://loremflickr.com/300/200",name:"your name here",publickey:"",location:"anytown usa",about:"",tags:"",twitter:"",facebook:"",instagram:"",youtube:"",tiktok:"",patreon:"",bitcoin:"35fqMZwsNokbAZsznmCvjVZLmiejAjW9EB",linkedin:"",github:"",more:""};function l(e,n,t){var o={cmd:"GeneralApi",generalInfo:n},r=JSON.stringify(o);console.log("jsonstr of GeneralApiCmd ",r);var s=u;i.d(s,e,r,(function(o,i){var r=(new TextDecoder).decode(o);if(console.log("App is  back from GeneralApi SendApiCommandOut from user ",e),void 0!==i)console.log("GeneralApi SendApiCommandOut timed out, retrying ",e),setTimeout((function(){l(e,n,t)}),15e3);else{var s=r.length>0?JSON.parse(r,h):{};t(s,i)}}))}var u={id:"GeneralApi",when:r.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleGeneralApi with ",r.t(n.topic),n.message.toString());var a=JSON.parse(n.message.toString()),c=r.k(n.topic),l="data/"+s.a(c.username).directory+"generalinfo.txt",u=function(t){var o=JSON.parse(t),r={cmd:"GeneralApi",generalInfo:o},s=JSON.stringify(r,d);Object(i.e)(n,e.from(s),null),a.generalInfo=o,i.a(c,a)};if(void 0!=a.generalInfo){var f=JSON.stringify(a.generalInfo,null,2);return void o.writeFile(l,e.from(f),(function(e){e&&console.log(" write GeneralInfo error "+l,e),u(f)}))}o.readFile(l,(function(e,n){e&&console.log(" read GeneralInfo error "+l,e),u(n)}))},options:new Map,returnAddress:"unused now"};function f(){return u}function d(e,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n}function h(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}}).call(this,t(9).Buffer)},65:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return h})),t.d(n,"b",(function(){return p})),t.d(n,"c",(function(){return v}));var o,i=t(10),r=t(28),s=t(32),a=t(84),c=t(83),l=t(11),u=t(80),f=t(3),d=t(22);function h(e){o=e}var p=new(function(e){Object(a.a)(t,e);var n=Object(c.a)(t);function t(){return Object(r.a)(this,t),n.apply(this,arguments)}return Object(s.a)(t,[{key:"keyofN",value:function(e){return e.when+" "+e.username}},{key:"keyofG",value:function(e){return e.when+" "+e.username}},{key:"useTheApi",value:function(e,n,t){var o,r=this,s=function(n,o){if(o)console.log("ERROR useTheApi timelineListReceiver has error",o);else{var s,a=r.getClient(e),c=Object(i.a)(n);try{for(c.s();!(s=c.n()).done;){var l=s.value;a.pending.delete(r.keyofG(l))}}catch(u){c.e(u)}finally{c.f()}t(n)}},a=Object(i.a)(n);try{for(a.s();!(o=a.n()).done;){var c=o.value;g(c.username,""+c.when,c.amt,s)}}catch(l){a.e(l)}finally{a.f()}}}]),t}(t(79).a));function g(e,n,t,o){var i={cmd:"GetTimeline",top:n,count:t},r=JSON.stringify(i),s=m;l.d(s,e,r,(function(i,r){var s=(new TextDecoder).decode(i);console.log("GetTimelineCmd returns w err ",r);var a=s.length>0?JSON.parse(s):[];void 0!==r?(console.log("GetTimelineCmd SendApiCommandOut have error,user ",r,e,f.p()),setTimeout((function(){console.log("GetTimelineCmd SendApiCommandOut timer done. IssueTheCommand AGAIN. "),g(e,n,t,o)}),3e3)):o(a,r)}))}var m={id:"GetTimeline",when:f.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){var i=JSON.parse(n.message.toString()),r=+i.top,s=i.count,a=f.k(n.topic),c="data/"+d.a(a.username).directory+"lists/timeline/";if(o.mkdirs(c,o.dummyCb),0!==s){var h=[],p=!1,g={countNeeded:s,newer:r,basePath:c,haveOne:function(t){if(p)return h.length;if(g.force){var o=JSON.stringify(h);return Object(l.e)(n,e.from(o),null),p=!0,h.length}var c=e.from(t).toString("utf8").split("\n"),u=0;for(u=0;u<c.length;u++){var f=c[u];if(JSON.parse(f).id<=r)break}for(c=c.slice(u),u=0;u<c.length;u++){var d=JSON.parse(c[u]);if(h.push(d),h.length>=s&&!1===p)break}if(h.length>=s&&!1===p){var m={items:h,username:a.username,when:+i.top},v=JSON.stringify([m]);Object(l.e)(n,e.from(v),null),p=!0}return h.length},done:!1,force:!1};u.c(g)}},options:new Map,returnAddress:"unused now"};function v(){return m}}).call(this,t(9).Buffer)},78:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var o=t(3),i=(t(11),t(34));var r={id:"Event",when:o.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(e,n){var t=JSON.parse(e.message.toString(),a);i.b(t)},options:new Map,returnAddress:"unused now",isEvent:!0};function s(){return r}function a(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}},79:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var o=t(10),i=t(28),r=t(32),s=function(){function e(){var n=this;Object(i.a)(this,e),this.theClients=void 0,this.timerID=void 0,this.isTesting=void 0,this.isTesting=!1,this.timerID=setInterval((function(){n.heartbeat()}),100),this.theClients=new Map}return Object(r.a)(e,[{key:"keyofN",value:function(e){return"keyoffixme1"}},{key:"keyofG",value:function(e){return"keyoffixme2"}},{key:"getClient",value:function(e){var n=this.theClients.get(e);if(void 0!==n)return n;var t={needed:new Map,pending:new Map,ready:[],owned:new Map,ref:e,subscribeLevel:0};return this.theClients.set(e,t),t}},{key:"need",value:function(e,n){var t,i=!1,r=this.getClient(e),s=Object(o.a)(n);try{for(s.s();!(t=s.n()).done;){var a=t.value,c=this.keyofN(a),l=r.pending.get(c),u=r.needed.get(c);void 0===l&&void 0===u&&(r.needed.set(c,a),i=!0)}}catch(f){s.e(f)}finally{s.f()}return i}},{key:"clearCache",value:function(e){var n=this.getClient(e);n.pending=new Map,n.owned=new Map}},{key:"subscribe",value:function(e,n){var t=this.getClient(e);t.callback=n,t.subscribeLevel+=1}},{key:"unsubscribe",value:function(e){this.getClient(e).subscribeLevel-=1}},{key:"heartbeat",value:function(){var e=this;this.theClients.forEach((function(n,t){var i=n,r=[];i.needed.forEach((function(e,n){var t=i.owned.get(n);t?i.ready.push(t):r.push(e)})),i.needed.clear();if(r.length>0){var s,a=Object(o.a)(r);try{for(a.s();!(s=a.n()).done;){var c=s.value;i.pending.set(e.keyofN(c),c)}}catch(l){a.e(l)}finally{a.f()}e.useTheApi(t,r,(function(n){var t,r=Object(o.a)(n);try{for(r.s();!(t=r.n()).done;){var s=t.value,a=e.keyofG(s);i.owned.set(a,s),i.ready.push(s)}}catch(l){r.e(l)}finally{r.f()}}))}i.callback&&0!==i.ready.length&&(i.callback(i.ready),i.ready=[])}))}},{key:"useTheApi",value:function(e,n,t){console.log("over ride me for petes sake")}}]),e}()},80:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return l}));var o;t(28),t(32);function i(e){o=e}function r(e){var n=e.newer.substr(0,6),t=e.basePath;console.log("fsGetPostsCounted dir is ",t),o.readdir(t,(function(o,i){if(o)console.log("Unable to scan directory: "+o+t);else{var r=[];i.forEach((function(e){e<=n&&r.push(e)})),r.sort(),r.reverse(),s(e,r)}}))}function s(e,n){if(0!==n.length&&!e.done){var t=e.basePath+n[0].substring(0,6);n=n.slice(1),o.readdir(t,(function(o,i){if(o)console.log("readFilesInDirList readdir error ",o,t);else{var r=[];i.sort();for(var s=0;s<i.length;s++){var c=i[s];if(!(c<e.newer))break;r.push(c)}r.reverse(),a(e,r,n)}}))}}function a(e,n,t){if(0!==n.length){var i=e.basePath+n[0].substring(0,6)+"/"+n[0];n=n.slice(1),o.readFile(i,(function(o,r){o?console.log("readFilesInFileList read file error "+i,o):e.haveOne(r,null)<e.countNeeded?a(e,n,t):e.done=!0}))}else e.done||s(e,t)}function c(n,t){if(0===t.length)return n.force=!0,void n.haveOne(e.from(""),null);var i=n.basePath+t[0];o.readFile(i,(function(e,o){e?n.haveOne(o,e):(n.haveOne(o,e),n.done||c(n,t.slice(1)))}))}function l(e){var n=(""+e.newer).substr(0,6),t=e.basePath;o.readdir(t,(function(o,i){if(o)console.log("Unable to scan directory: "+o+t);else{i.sort(),i.reverse();var r=0;for(r=0;r<i.length&&!(i[r]<=n);r++);var s=i.slice(r);c(e,s)}}))}}).call(this,t(9).Buffer)},82:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return C})),t.d(n,"b",(function(){return x})),t.d(n,"c",(function(){return P}));var o=t(145),i=t.n(o),r=t(222),s=t(8),a=t(15),c=t(146),l=t.n(c),u=(t(426),t(66)),f=t(19),d=t(3),h=t(57),p=t(37),g=t(11),m=t(78),v=t(34),b="",w="";var y=0,k=!1;var O=!1,j=0;function C(e){if(console.log("in bootSequence with ",y),O)console.log("bootSequence pending with ",y);else if(0===y){var n=function(e){if(k)return null;if(void 0===localStorage)return null;return localStorage.getItem(e)}("knotfree_access_token_v2");if(n&&n.length>0){var t,o=d.f(n),i=Object(a.a)(o,2);t=i[0],""===i[1]?(console.log("got token from local knotfree_access_token_v2 server = ",t),w=n,y=1,e(!1,"Token verified.")):(P("knotfree_access_token_v2",""),e(!1,"Bad token."))}else{O=!0,function(e,n){(e=e.replace("3000","8085")).endsWith("/")||(e+="/");var t="http://"+e+"api1/getPublicKey";console.log("in pingServer with",t);var o=function(e,n){return S.apply(this,arguments)}(t,{});o.then((function(e){console.log("pingServer have response ",e,"from server",t),e.ok?e.text().then((function(e){console.log("pingServer have api1/getPublicKey result ",e),b=e,n(!0)})):(console.log("pingServer have api1/getPublicKey ERROR ",e),n(!1))})),o.catch((function(e){console.log("pingServer got error contacting host "+t,e),n(!1)}))}(d.q(),(function(n){if(O=!1,n){var t=d.q();O=!0,x(t,(function(n,t){O=!1,console.log("back from apputil.getFreeToken, ",n),n?(console.log("have token , ",t),y=1,e(!1,"Got free token.")):e(!1,"Get free token failed.")}))}else console.log("apputil.pingServer fail with knotfree.net "),e(!1,"Ping server failed.")}))}}else 1===y?(console.log("we have the pubk  ",b),console.log("we have the token  ",w),O=!0,function(e){var n=d.q();0;n.endsWith("/")&&(n=n.slice(0,n.length-1));console.log("startTheMqtt with.",n),function(e,n,t){console.log("StartClientMqtt called");var o=Object(s.a)(Object(s.a)({},d.h),{},{username:"Anonymous",password:["Anonymous","Anonymous"]});d.u(o),d.w(o);var i=Object(s.a)(Object(s.a)({},d.h),{},{username:d.n(),password:[]});d.u(i),d.w(i),function(){var o={config:{token:e,items:[]},isClient:!0},i={broadcast_CleanOldItems:v.a,broasdcastSubscribeAll:v.d,eventapi_getWr:m.a,pingapi_getWr:h.c,api_getAllHooks:g.f,do_ping:h.b};f.a(o,i);var r=f.b;f.c.handleMqttConnect(n,r,t)}()}(w,n,(function(n){console.log("returned from mqtt no news is good: ",n),n.length?(console.log("mqtt has err here ",n),f.c?f.c.CloseTheConnect():console.log("ERROR tryToStartMqttPart2 freaking fail. damn."),e(!1)):(console.log("mqtt 2 success in AppUtil 2"),e(!0))}))}((function(n){O=!1,n?(y=2,e(!1,"MQTT started.")):e(!1,"MQTT failure.")}))):2===y?(O=!0,function(e){var n=d.m(d.n());console.log("AppUtil ping will use this name",n.username,d.p());var t=d.n();h.a("Anonymous",t,(function(n,t){if(t)console.log("ERROR in ping from token screen "),e(!1);else{console.log("AppUtil Ping is back ",d.p());var o=d.m(d.n());console.log("Have pubk from ping of ",o.username);var i=d.i(n.pub);o.initialized=!1,d.u(o),o.ourPublicKey=[i],o=d.m(d.n()),console.log("Have pubk from ping of ",d.z(o.ourPublicKey[0])),P("knotfree_access_token_v2",w),console.log("mqtt success 2 pubkey setting localStorage.setItem knotfree_access_token_v2"),e(!0)}}))}((function(n){O=!1,n?(j+=1,console.log("we have a good ping  ",d.p()),j>4?(y=3,e(!1,"Ping returned public key.")):e(!1,"Still trying ping.")):e(!1,"Ping failed.")}))):3===y&&(O=!0,function(e){var n=d.m(d.n());console.log("AppUtil getFriends will use this name",n.username,d.p());var t=d.n();p.c(t,1,0,(function(n,t){t?(console.log("ERROR in getFriends from apiUtil "),e(!1,n)):(console.log("AppUtil getFriends is back ",d.p()),e(!0,n))}))}((function(n,t){O=!1,n?(console.log("we have friends !!  ",d.p()),p.b.set(d.n().toLowerCase(),t),y=4,console.log("increment(true) // we're done "),e(!0,"Success.")):e(!1,"Get friends failed.")})))}function x(n,t){n.endsWith("/")||(n+="/");var o="http://"+n+"api1/getToken",i={pkey:"fixme",payload:R(),Comment:"For "+d.n()},r=u.b();i.pkey=e.from(r.publicKey).toString("hex"),console.log("AppUtil getFreeToken ",o,JSON.stringify(i)),l()(o,{method:"POST",body:JSON.stringify(i)}).then((function(n){console.log("have get free token response ",n),n.ok?n.json().then((function(n){console.log("have get free token  fetch result ",n);var o=e.from(n.pkey,"hex"),i=e.from(n.payload,"hex"),s=e.from(n.nonce),a=u.d(i,s,o,r.secretKey);if(void 0===a)console.log("FAILURE decoded free token fetch result ",a),t(!1,"");else{var c=e.from(a).toString("utf8");console.log("have decoded free token  fetch result ",c),t(!0,w=c)}})):(console.log("have get free token fetch problem ",n),setTimeout((function(){t(!1,"")}),2e3))}))}function S(){return(S=Object(r.a)(i.a.mark((function e(n,t){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()(n,Object(s.a)({},t));case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return{exp:999,iss:"xxx",jti:"xxx",in:32,out:32,su:10,co:2,URL:"unknown"}}function P(e,n){if(!k&&void 0!==localStorage)return localStorage.setItem(e,n)}}).call(this,t(9).Buffer)},96:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return l})),t.d(n,"a",(function(){return u})),t.d(n,"c",(function(){return d}));var o,i=t(8),r=t(3),s=t(11),a=t(22),c=t(13);function l(e){o=e}r.v("anon err");function u(e,n,t){var o={cmd:"SavePost",post:n},i=JSON.stringify(o,h),r=f;Object(s.d)(r,e,i,(function(o,i){var r=(new TextDecoder).decode(o),s=r.length>0?JSON.parse(r,p):{};void 0!==i?setTimeout((function(){u(e,n,t)}),1e3):t(s,i)}))}var f={id:"SavePost",when:r.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleSavePostApi with ",r.t(n.topic),n.message.toString());var l=JSON.parse(n.message.toString(),p);if(void 0===l.post)return void console.log("in the handleSavePostApi error undefined post ",r.t(n.topic),n.message.toString());if(0===l.post.id){var u=r.j();l.post.id=u}var f=l.post;console.log(" on the server in handleSavePostApi with ",f.id,f.title);var d=r.k(n.topic)||r.h;!function(n,t){console.log(" savepost writePostToFile",t.id);var i=Math.floor(t.id/1e9),r=n+"lists/posts/"+i+"/",s=""+t.id,a=r+s,c=JSON.stringify(t,null,2);o.mkdirs(r,o.dummyCb),console.log(" writePostToFile writing ",a),o.writeFile(a,e.from(c),(function(e){if(e)return console.error(e);console.log(" writePostToFile File created!")}))}("data/"+a.a(d.username).directory,f);var g={cmd:"SavePost",post:l.post},m=JSON.stringify(g,h);Object(s.e)(n,e.from(m),null);var v=Object(i.a)(Object(i.a)({},c.f),{},{id:l.post.id});l.post=v,s.a(d,l)},options:new Map,returnAddress:"unused now"};function d(){return f}function h(e,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n}function p(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}}).call(this,t(9).Buffer)},97:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return a})),t.d(n,"a",(function(){return c})),t.d(n,"c",(function(){return u}));var o,i=t(3),r=t(11),s=t(22);function a(e){o=e}function c(e,n,t,o){var i={cmd:"DeletePost",id:n},s=JSON.stringify(i,f),a=l;r.d(a,e,s,(function(e,n){var o=(new TextDecoder).decode(e),i=o.length>0?JSON.parse(o,d):{};t(i,n)}))}var l={id:"DeletePost",when:i.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleDeletePostApi with ",n.topic,n.message.toString());var a=JSON.parse(n.message.toString(),d),c=i.k(n.topic),l="data/"+s.a(c.username).directory;console.log(" on the server in handleDeletePostApi with ",a.id),function(e,n){var t=Math.floor(n/1e9),i=e+"lists/posts/"+t+"/",r=i+""+n;o.mkdirs(i,(function(e){e&&console.log("mkdirs err",e)})),console.log(" deletePostFile writing ",r),o.unlink(r,(function(e){e?console.log("ERROR deletePostFile",r):console.log(" deletePostFile File deleted!",r)}))}(l,a.id);var u={cmd:"DeletePost",id:a.id},h=JSON.stringify(u,f);r.e(n,e.from(h),null),r.a(c,a)},options:new Map,returnAddress:"unused now"};function u(){return l}function f(e,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n}function d(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}}).call(this,t(9).Buffer)},98:function(e,n,t){"use strict";(function(e){t.d(n,"b",(function(){return a})),t.d(n,"a",(function(){return c})),t.d(n,"c",(function(){return u}));var o,i=t(3),r=t(11),s=t(22);function a(e){o=e}function c(e,n,t,o){var i={cmd:"IncrementLikes",id:n,who:t},s=JSON.stringify(i,f),a=l;r.d(a,e,s,(function(i,r){var s=(new TextDecoder).decode(i),a=s.length>0?JSON.parse(s,d):{};void 0!==r?(console.log("IncrementLikesCmd error ",r),setTimeout((function(){c(e,n,t,o)}),1e3)):o(a,r)}))}var l={id:"IncrementLikes",when:i.l(),permanent:!0,topic:"unknown",message:new Uint8Array,replydata:new Uint8Array,waitingCallbackFn:function(n,t){console.log("in the handleIncrementLikesApi with ",n.topic,n.message.toString());var a=JSON.parse(n.message.toString(),d),c=i.k(n.topic),l="data/"+s.a(c.username).directory;console.log(" on the server in handleIncrementLikesApi with ",a.id),function(n,t,i,s,a){var c=Math.floor(t/1e9),l=n+"lists/posts/"+c+"/"+t;console.log(" IncrementLikesFile writing ",l),o.readFile(l,(function(c,u){if(c)console.log(" read post in likes error "+n,c);else{var h=JSON.parse(u.toString("utf8"),d);h.likes+=1;var p=JSON.stringify(h,f);o.writeFile(l,p,(function(o){if(o)console.log(" write post in likes error "+n,o);else{var c={cmd:"IncrementLikes",id:t},l=JSON.stringify(c,f);r.e(i,e.from(l),null),r.a(s,a)}}))}}))}(l,a.id,n,c,a)},options:new Map,returnAddress:"unused now"};function u(){return l}function f(e,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n}function d(e,n){return"object"===typeof n&&null!==n&&"Map"===n.dataType?new Map(n.value):n}}).call(this,t(9).Buffer)}},[[430,1,2]]]);